@{
    Layout = null;
    ViewBag.Title = "后台管理-新增会员";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <link href="~/Content/Admin/css/bootstrap-cerulean.min.css" rel="stylesheet" />
    <link href="~/Content/Admin/css/charisma-app.css" rel="stylesheet" />
    <link href="~/Content/common.css" rel="stylesheet" />

    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/comm.js"></script>
    <script src="~/Scripts/lhgdialog/lhgdialog.min.js"></script>
    <script src="~/Content/laydate/laydate.js"></script>
</head>
<body>
    <div id="content" class="main-content">
        <div class="">
            <div class="carousel box-inner">
                <div class="box-header well clearfix" data-original-title="">
                    <h2><i class="glyphicon glyphicon-hand-right"></i>目前操作功能：@ViewBag.Title</h2>
                </div>
                <ul class="media nav nav-tabs margin-b-10">
                    <li class="active">
                        <a href="javascript:void(0);" title="">基本信息</a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" title="">详细信息</a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" title="">权限信息</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="container tab-pane active">
                        <form class="form-horizontal min-height-main" role="form">
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">帐号：</label>
                                <div class="pull-left">
                                    <input id="txtAccount" class="form-control" type="text" value="" maxlength="31">
                                </div>
                                <span class="pull-left control-label"><i>*&nbsp;</i>请输入帐号,由字母、数字、下划线和汉字组成！</span>
                            </div>
                            <div class="form-group new-input-style" style="display:none">
                                <label class="pull-left control-label">用户昵称：</label>
                                <div class="pull-left">
                                    <input id="txtNickName" class="form-control" type="text" value="" maxlength="31">
                                </div>
                                <span class="pull-left control-label">不填则与帐号相同 由字母、数字、下划线和汉字组成！</span>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">登录密码：</label>
                                <div class="pull-left">
                                    <input id="txtLogonPass" class="form-control" type="password" value="" maxlength="32">
                                </div>
                                <span class="pull-left control-label"><i>*&nbsp;</i>请输入登录密码 密码长度为6-32位</span>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">确认登录密码：</label>
                                <div class="pull-left">
                                    <input id="txtLogonPass2" class="form-control" type="password" value="" maxlength="32">
                                </div>
                                <span class="pull-left control-label"><i>*&nbsp;</i>请输入确认登录密码</span>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">保险柜密码：</label>
                                <div class="pull-left">
                                    <input id="txtInsurePass" class="form-control" type="password" value="" maxlength="32">
                                </div>
                                <span class="pull-left control-label">不填则与登录密码相同</span>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">确认保险柜密码：</label>
                                <div class="pull-left">
                                    <input id="txtInsurePass2" class="form-control" type="password" value="" maxlength="32">
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">个性签名：</label>
                                <div class="pull-left">
                                    <textarea class="form-control" id="txtUnderWrite" rows="5" placeholder="个性签名"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="pull-left new-input-style" style="display: inline-block;">
                                    <label class="pull-left control-label">性别：</label>
                                    <select class="form-control" id="ddlGender">
                                        <option value="">男</option>
                                        <option value="">女</option>
                                    </select>
                                </div>
                                @*<div class="pull-left new-input-style" style="display: inline-block;">
                                    <label class="pull-left control-label">会员级别：</label>
                                    @Html.HtmlMemberOrderSelectBuilder()
                                </div>*@
                            </div>
                            <div class="form-group new-input-style margin-b-0">
                                <label class="pull-left control-label">头像：</label>
                                <input id="inFaceID" name="inFaceID" type="hidden" value="" />
                                <img id="picFace" src="../Content/images/gamepic/Avatar0.png" alt="" title="" class="pull-left" style="width: 96px;height: 96px;" />
                                <a id="btnSwitchFace" href="javascript:void(0)" title="" class="pull-left" style="margin: 80px 0 0 10px;">查看更多头像</a>
                            </div>
                            <div class="form-group new-input-style margin-b-0">
                                <label class="pull-left control-label">选项：</label>
                                <p>
                                    <span class="checkbox-inline">
                                        <input type="checkbox" id="ckbNullity" value="1" />
                                        <label for="inlineCheckbox1">冻结帐号</label>
                                    </span>
                                    <span class="checkbox-inline">
                                        <input type="checkbox" id="ckbStunDown" value="1" />
                                        <label for="inlineCheckbox2">安全关闭</label>
                                    </span>
                                    <span class="checkbox-inline">
                                        <input type="checkbox" id="chkIsAndroid" value="1" />
                                        <label for="inlineCheckbox3">设为机器人</label>
                                    </span>
                                </p>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">锁定机器：</label>
                                <p>
                                    <span class="">
                                        <input type="radio" name="rdoMoorMachine" id="optionsRadios3" value="0" checked />
                                        <label for="optionsRadios3">未锁定</label>
                                    </span>
                                    <span class="checkbox-inline">
                                        <input type="radio" name="rdoMoorMachine" id="optionsRadios4" value="1" />
                                        <label for="optionsRadios4">客户端锁定</label>
                                    </span>
                                    <span class="checkbox-inline" style="display:none">
                                        <input type="radio" name="rdoMoorMachine" id="optionsRadios5" value="2" />
                                        <label for="optionsRadios5">网页锁定</label>
                                    </span>
                                </p>
                            </div>
                            <div class="form-group new-input-style" style="display:none">
                                <label class="pull-left control-label">经验值：</label>
                                <div class="pull-left">
                                    <input id="txtExperience" class="form-control" type="text" value="0" maxlength="8" onkeyup="if (isNaN(value)) execCommand('undo');">
                                </div>
                            </div>
                            <div class="form-group new-input-style" style="display:none">
                                <label class="pull-left control-label">魅力值：</label>
                                <div class="pull-left">
                                    <input id="txtLoveLiness" class="form-control" type="text" value="0" maxlength="8" onkeyup="if (isNaN(value)) execCommand('undo');">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="container tab-pane">
                        <form class="form-horizontal min-height-main" role="form">
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">真实姓名：</label>
                                <div class="pull-left">
                                    <input id="txtCompellation" class="form-control" type="text" value="" maxlength="16">
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">QQ号码：</label>
                                <div class="pull-left">
                                    <input id="txtQQ" class="form-control" type="text" value="" maxlength="16" onkeyup="if(isNaN(value)) execCommand('undo');">
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">电子邮箱：</label>
                                <div class="pull-left">
                                    <input id="txtEMail" class="form-control" type="text" value="" maxlength="32">
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">固定电话：</label>
                                <div class="pull-left">
                                    <input id="txtSeatPhone" class="form-control" type="number" value="" maxlength="32">
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">手机号码：</label>
                                <div class="pull-left">
                                    <input id="txtMobilePhone" class="form-control" type="tel" value="" maxlength="16" onkeyup="if (isNaN(value)) execCommand('undo');">
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">邮政编码：</label>
                                <div class="pull-left">
                                    <input id="txtPostalCode" maxlength="8" onkeyup="if (isNaN(value)) execCommand('undo');" class="form-control" type="number" value="">
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">居住地址：</label>
                                <div class="pull-left">
                                    <textarea class="form-control" id="txtDwellingPlace" rows="5" placeholder="居住地址" maxlength="128"></textarea>
                                </div>
                            </div>
                            <div class="form-group new-input-style">
                                <label class="pull-left control-label">用户备注：</label>
                                <div class="pull-left">
                                    <textarea class="form-control" id="txtUserNote" rows="5" placeholder="用户备注" maxlength="128"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="container tab-pane">
                        <form class="form-horizontal min-height-main" role="form">
                            <div class="form-group new-input-style margin-b-0 clearfix">
                                <label class="pull-left control-label">用户权限：</label>
                                <div class="pull-left" style="width: 600px;">
                                    <p class="">
                                        <span class="">
                                            <input type="checkbox" id="detailedInfoCheckboxAll" value="" onclick="SelectAll(this, 'ckbUserRight')" />
                                            <label for="detailedInfoCheckboxAll">全选</label>
                                        </span>
                                    </p>
                                    @Html.HtmlUserRightCHKListBuilder()
                                </div>
                            </div>
                            <div class="form-group  new-input-style margin-t-b ">
                                <label class="pull-left control-label">用户身份：</label>
                                <select class="form-control">
                                    <option value="">玩家</option>
                                    <option value="">管理人员</option>
                                </select>
                            </div>
                            <div class="form-group new-input-style margin-b-0 clearfix">
                                <label class="pull-left control-label">管理权限：</label>
                                <div class="pull-left" style="width: 600px;">
                                    <p class="">
                                        <span class="">
                                            <input type="checkbox" id="adminAuthorityCheckboxAll" value="" onclick="SelectAll(this, 'ckbMasterRight')" />
                                            <label for="adminAuthorityCheckboxAll">全选</label>
                                        </span>
                                    </p>
                                    @Html.HtmlMasterRightCHKListBuilder()
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="footer-absolute">
                    <ul class="cursor-style clearfix new-add-btn">
                        <li class="pull-left" style="margin-right: 10px;">
                            @if (Game.Facade.Tools.TypeUtil.IsPower((int)ViewBag.ModuleID, (int)ViewBag.UserID, "添加"))
                            { <a class="btn btn-success search btn-md" href="#" onclick="Add();"><i class="glyphicon glyphicon-send"></i>保存</a>}
                        </li>
                        <li class="pull-left">
                            <a class="btn btn-primary search btn-md" href="#" onclick="window.close();"><i class="glyphicon glyphicon-off"></i>关闭</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            //弹出页面
            $('#btnSwitchFace').dialog({
                id: 'winUserfaceList',
                title: '更换头像',
                width: 540,
                height: 385,
                content: 'url:@Url.Action("UserFaceList", "Account")?ModuleID=' + parseInt('@ViewBag.ModuleID'),
                min: false,
                max: false,
                fixed: true,
                drag: false,
                resize: false
            });
            tabShow($(".nav li"), $(".tab-pane"), "active");
        });
        var tabShow = function (tab, con, className) {
            tab.click(function () {
                var indx = tab.index(this);
                tab.removeClass(className);
                $(this).addClass(className);
                con.hide();
                con.eq(indx).show();
            })
        };
        function Add() {
            var istrue = true;
            var Accounts = $("#txtAccount").val();
            if (Accounts != "") {
                switch (isValidAccountCombination(Accounts)) {
                    case 1:
                        alert("帐号含有空格");
                        istrue = false;
                        break;
                    case 2:
                        alert("帐号汉字位数不足");
                        istrue = false;
                        break;
                    case 3:

                        break;
                    case 4:
                        alert("帐号位数不足");
                        istrue = false;
                        break;
                    default:
                        alert("帐号格式有误");
                        istrue = false;
                        break;
                }
            } else {
                istrue = false;
                $("#lblacount").html("请输入帐号,由字母、数字、下划线和汉字组成！");
            }
            var NickName = $("#txtNickName").val();
            if (istrue) {
                if (NickName == "") {
                    NickName = Accounts;
                } else {
                    switch (isValidAccountCombination(NickName)) {
                        case 1:
                            alert("用户昵称含有空格");
                            istrue = false;
                            break;
                        case 2:
                            alert("用户昵称汉字位数不足");
                            istrue = false;
                            break;
                        case 3:

                            break;
                        case 4:
                            alert("用户昵称位数不足");
                            istrue = false;
                            break;
                        default:
                            alert("用户昵称格式有误");
                            istrue = false;
                            break;
                    }
                }
            }
            var LogonPass = $("#txtLogonPass").val();
            if (istrue && LogonPass == "") {
                alert("登录密码不能为空！");
                istrue = false;
            }
            var LogonPass2 = $("#txtLogonPass2").val();
            if (istrue && LogonPass2 == "") {
                alert("确认登录密码不能为空！");
                istrue = false;
            }
            if (LogonPass != LogonPass2) {
                alert("两次输入的登录密码不一致!");
                istrue = false;
            }
            var InsurePass = $("#txtInsurePass").val();
            if (istrue && InsurePass == "") {
                InsurePass = LogonPass;
            }
            var InsurePass2 = $("#txtInsurePass2").val();
            if (istrue && InsurePass != InsurePass2 && $("#txtInsurePass").val() != "") {
                alert("两次输入的保险柜密码不一致!");
                istrue = false;
            }
            var UnderWrite = $("#txtUnderWrite").val();
            //if (istrue && UnderWrite == "") {
            //    alert("个性签名不能为空!");
            //    istrue = false;
            //}
            var Gender = $("#ddlGender").val();
            var FaceID = $("#inFaceID").val();
            var Nullity = $("#ckbNullity").is(':checked') ? 1 : 0;
            var StunDown = $("#ckbStunDown").is(':checked') ? 1 : 0;
            var IsAndroid = $("#chkIsAndroid").is(':checked') ? 1 : 0;
            var MoorMachine = $("input[name='rdoMoorMachine']:checked").val();
            var Experience = $("#txtExperience").val();
            if (Experience == "" || isNaN(Experience)) {
                istrue = false;
                alert("经验值不能为空!");
            }
            var Present = $("#txtPresent").val();
            if (Present == "" || isNaN(Present)) {
                //istrue = false;
                //alert("礼物不能为空!");
                Present = 0;
            }
            var LoveLiness = $("#txtLoveLiness").val();
            if (LoveLiness == "" || isNaN(LoveLiness)) {
                istrue = false;
                alert("魅力值不能为空!");
            }
            var MemberOrder = 0;//$("#ddlMemberOrder").val();
            var Compellation = $("#txtCompellation").val();
            //if (Compellation == "") {
            //    istrue = false;
            //    alert("真实姓名不能为空!");
            //}
            var QQ = $("#txtQQ").val();
            //if (QQ == "" || isNaN(QQ)) {
            //    istrue = false;
            //    alert("QQ不能为空!");
            //}
            var EMail = $("#txtEMail").val();
            //if (EMail == "") {
            //    istrue = false;
            //    alert("EMail不能为空!");
            //} else {
            if (EMail != "") {
                if (!isEmail(EMail)) {
                    istrue = false;
                    alert("EMail格式不正确!");
                }
            }
            var SeatPhone = $("#txtSeatPhone").val();
            //if (SeatPhone == "") {
            //    istrue = false;
            //    alert("固定电话不能为空!");
            //} else {
            if (SeatPhone != "") {
                if (!isPhone(SeatPhone)) {
                    istrue = false;
                    alert("固定电话格式不正确!");
                }
            }
            var MobilePhone = $("#txtMobilePhone").val();
            //if (MobilePhone == "") {
            //    istrue = false;
            //    alert("手机不能为空!");
            //} else {
            if (MobilePhone != "") {
                if (!isPhone(MobilePhone)) {
                    istrue = false;
                    alert("手机格式不正确!");
                }
            }
            var PostalCode = $("#txtPostalCode").val();
            //if (PostalCode=="") {
            //    istrue = false;
            //    alert("邮政编码不能为空!");
            //}else{
            if (PostalCode != "") {
                if (!isPhone(MobilePhone)) {
                    istrue = false;
                    alert("邮政编码不正确!");
                }
            }
            var DwellingPlace = $("#txtDwellingPlace").val();
            var UserNote = $("#txtUserNote").val();
            var UserRight = 0, MasterRight = 0;
            $("input[name='ckbUserRight']:checked").each(function (i, item) {
                UserRight += parseInt($(item).val());
            });
            //if (UserRight == 0) {
            //    istrue = false;
            //    alert("请选择用户权限!");
            //}
            $("input[name='ckbMasterRight']:checked").each(function (i, item) {
                MasterRight += parseInt($(item).val());
            });
            //if (MasterRight == 0) {
            //    istrue = false;
            //    alert("请选择管理权限!");
            //}
            var MasterOrder = $("#ddlMasterOrder").val();
            if (istrue) {
                var data = { Accounts: Accounts, NickName: NickName, LogonPass: LogonPass, InsurePass: InsurePass, UnderWrite: UnderWrite, Gender: Gender, FaceID: FaceID, Nullity: Nullity, StunDown: StunDown, IsAndroid: IsAndroid, MoorMachine: MoorMachine, Experience: Experience, Present: Present, LoveLiness: LoveLiness, MemberOrder: MemberOrder, Compellation: Compellation, QQ: QQ, EMail: EMail, SeatPhone: SeatPhone, MobilePhone: MobilePhone, PostalCode: PostalCode, DwellingPlace: DwellingPlace, UserNote: UserNote, UserRight: UserRight, MasterRight: MasterRight, MasterOrder: MasterOrder };
                data.ModuleID = parseInt('@ViewBag.ModuleID');
                AjaxSubmit("/Account/AddNewAccount", data, callBack, "add");
            }
        }
        //回调函数
        function callBack(jsonData, fname) {
            if (fname == "add") {
                alert(jsonData.Msg);
                window.close();
                window.opener.location.reload();
            }
        }
    </script>
</body>

</html>
